<!doctype html><html lang=en dir=auto>
<head><meta charset=utf-8>
<meta http-equiv=x-ua-compatible content="IE=edge">
<meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no">
<meta name=robots content="index, follow">
<title>Syncing database data with PowerShell and SQL Data Compare | Joao Grassi's blog</title>
<meta name=keywords content="powershell,SQL,redgate-sql-data-compare">
<meta name=description content="Learn how to use PowerShell to sync databases with the help of Redgate SQL Data Compare in a configurable and easy to maintain way.">
<meta name=author content="Joao Grassi">
<link rel=canonical href=https://blog.joaograssi.com/powershell-sql-data-compare-sync/>
<link crossorigin=anonymous href=/assets/css/stylesheet.min.a62f9b67a2ed8d7ac28c4555d29a3928a4b4f7b8f363dc332d58a581310d0418.css integrity="sha256-pi+bZ6LtjXrCjEVV0po5KKS097jzY9wzLVilgTENBBg=" rel="preload stylesheet" as=style>
<script defer crossorigin=anonymous src=/assets/js/highlight.min.7680afc38aa6b15ddf158a4f3780b7b1f7dde7e91d26f073e6229bb7a0793c92.js integrity="sha256-doCvw4qmsV3fFYpPN4C3sffd5+kdJvBz5iKbt6B5PJI=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://blog.joaograssi.com/favicon.ico>
<link rel=icon type=image/png sizes=16x16 href=https://blog.joaograssi.com/favicon-16x16.png>
<link rel=icon type=image/png sizes=32x32 href=https://blog.joaograssi.com/favicon-32x32.png>
<link rel=apple-touch-icon href=https://blog.joaograssi.com/apple-touch-icon.png>
<link rel=mask-icon href=https://blog.joaograssi.com/safari-pinned-tab.svg>
<meta name=theme-color content="#2e2e33">
<meta name=msapplication-TileColor content="#2e2e33">
<meta name=generator content="Hugo 0.92.2">
<noscript>
<style>#theme-toggle,.top-link{display:none}</style>
<style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style>
</noscript><meta property="og:title" content="Syncing database data with PowerShell and  SQL Data Compare">
<meta property="og:description" content="Learn how to use PowerShell to sync databases with the help of Redgate SQL Data Compare in a configurable and easy to maintain way.">
<meta property="og:type" content="article">
<meta property="og:url" content="https://blog.joaograssi.com/powershell-sql-data-compare-sync/"><meta property="og:image" content="https://blog.joaograssi.com/powershell-sql-data-compare-sync/powershell-sqldatacompare-cover.png"><meta property="article:section" content="posts">
<meta property="article:published_time" content="2018-08-17T20:41:00+00:00">
<meta property="article:modified_time" content="2018-08-17T20:41:00+00:00">
<meta name=twitter:card content="summary_large_image">
<meta name=twitter:image content="https://blog.joaograssi.com/powershell-sql-data-compare-sync/powershell-sqldatacompare-cover.png">
<meta name=twitter:title content="Syncing database data with PowerShell and  SQL Data Compare">
<meta name=twitter:description content="Learn how to use PowerShell to sync databases with the help of Redgate SQL Data Compare in a configurable and easy to maintain way.">
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://blog.joaograssi.com/posts/"},{"@type":"ListItem","position":3,"name":"Syncing database data with PowerShell and  SQL Data Compare","item":"https://blog.joaograssi.com/powershell-sql-data-compare-sync/"}]}</script>
<script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Syncing database data with PowerShell and  SQL Data Compare","name":"Syncing database data with PowerShell and  SQL Data Compare","description":"Learn how to use PowerShell to sync databases with the help of Redgate SQL Data Compare in a configurable and easy to maintain way.","keywords":["powershell","SQL","redgate-sql-data-compare"],"articleBody":"The database team at my current job had successfully integrated the databases into source control using Redgate SQL Source Control. Developers now have a local instance of the databases linked to Source Control and for them to add or change things it’s a breeze.\nThe “adding databases into source control” statement is comprised of basically adding all the objects to source control. E.g. Tables, Views, Procedures and so on. Apart from adding database objects, there were also a couple of Tables identified as “Enum” tables. These tables are those that all of us developers are very familiar with. They usually contain lookup data, like Statuses and Countries.\nAn example of an Enum table  The problem started here: We have several data centers and these enum data should be, of course, the same everywhere. At this point, when someone wanted a new value available in production, they would add it, commit and push. Then, open a ticket with the database team so they could deploy the new value everywhere. As you are probably thinking, this is.. let’s say, not very efficient.\nTo solve that we built a tool to manage this set of Enum/Configuration data. This tool is responsible for creating and sending this data everywhere. This was great since our tool now synchronizes the changes to all production db’s and to one internal “master”. This improved drastically the productivity for everyone.\nBut, there was one downside: The developer’s local instances were now outdated!. Since the enum tables are now managed by an external tool, there was no need to keep them in source control. And if they are not in source control developers can’t just do git pull and expect to get the data anymore.\nThe solution Use Redgate SQL Data Compare! Maybe not everyone knows but SQL Data Compare also works via the command line. Basically everything you can do using the UI you can do using the command line, which is awesome!\nOur requirements:  Develop a solution that works seamlessly and that requires minimal effort from the developers That would be easy to change once more Enum tables are removed from source control  Having that in mind, what we came up was: A PowerShell script that uses SQL Data Compare to “sync” the dev’s local instance with the master database managed by our central tool.\nChallenges: The PowerShell script more or less solved requirement #1. Developers would still have to run the script, but that can be easily solved by scheduling a task on Windows Task Scheduler. So requirement 1 - Solved!\nRequirement #2 was a little more tricky though. Summarizing, we had to compare 3 databases and each had different configurations (which Table to compare and so on). Also important was: As we take more Enum data out of source control, we needed a way to easily add the new tables in the comparison so developers could get fresh data again.\nFortunately, SQL Data Compare command line offers a way to use a .xml file to specify the parameters and configuration relevant to each database. There’s a nice documentation with a few examples on how to use XML to specify command line arguments\nWe took leverage of the .xml configuration files and created one for each database we needed to compare. This is nice because:\n You can (and should!) put it on source control. So changes are made in a safe way It separates each database with its own set of configurations and tables Allows the PowerShell script to be “generic” and database agnostic.  Code: Basically the PowerShell script accepts just one argument. The name of the .xml configuration file. An example of such configuration file looks like this:\n  myapp-db DB-MASTER myapp-db (local)\\DevInstance  Table Identical Table:\\[AppStatus\\]   I’m not going into too much details of what each node do since the documentation already offers everything you need to know: Switches used in the command line and Options used in the command line\nThe final script looks like this: param ( [Parameter(Mandatory = $true)] [string] $compareConfigFile ) # Get the Installation path of a given program Gladly copied from: https://info.sapien.com/index.php/scripting/scripting-how-tos/how-to-find-installation-directory #  function Get-InstallPath { [CmdletBinding()] [OutputType([PSCustomObject])] Param ( [Parameter(Mandatory = $true)] [SupportsWildcards()] [string] $ProgramName ) $result = @() if ($inst = Get-ChildItem \"HKLM:\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\Installer\\UserData\\*\\Products\\*\\InstallProperties\" -ErrorAction SilentlyContinue) { $inst | Where-Object { ($DisplayName = $_.getValue('DisplayName')) -like \"*$ProgramName*\" } | ForEach-Object { $result += [PSCustomObject]@{ 'DisplayName' = $displayName 'Publisher' = $_.getValue('Publisher') 'InstallPath' = $_.getValue('InstallLocation') } } } else { Write-Error \"Cannot get the InstallProperties registry keys.\"; } if ($result) { return $result; } else { Write-Error \"Cannot get the InstallProperties registry key for $ProgramName\"; } } try { if (!(Test-Path $compareConfigFile)) { Throw \"Could not find the specified xml config file: $compareConfigFile\"; } Write-Host \"################ Initilizing SQL Data Compare Script #################\"; Write-Host \"\"; Write-Host \"Info: \" -ForegroundColor Blue -NoNewline; Write-Host \"Looking for SQL Data Compare on the machine...\"; $sqlDataCompareFolderName = \"SQL Data Compare\"; $sqlDataCompareExecutableName = \"SQLDataCompare.exe\"; # Gets the installation path from registry for SQL Data Compare (the version number at the end makes impossible to hardcode) $sqlCompareInstallPath = (Get-InstallPath -ProgramName $sqlDataCompareFolderName).InstallPath; $fullExecutablePath = Join-Path -path $sqlCompareInstallPath -childpath $sqlDataCompareExecutableName; # Should be there, but just as a sanity check if (!(Test-Path \"$fullExecutablePath\")) { Throw \"SQL Data Compare was not found in the machine.\"; } Write-Host \"Success: \" -ForegroundColor Green -NoNewline; Write-Host \"SQL Data Compare found at: $fullExecutablePath\"; Write-Host \"\"; Write-Host \"Info: \" -ForegroundColor Blue -NoNewline; Write-Host \"Starting SQL Data Compare using the following XML config file: $compareConfigFile\"; Write-Host \"\"; \u0026 \"$fullExecutablePath\" /Argfile:$compareConfigFile; if ($LASTEXITCODE -eq 0) { Write-Host \"Database updated successfully.\" -ForegroundColor Green; } else { Write-Host \"Error: Database updated failed. See the above errors. \" -ForegroundColor Red; } } Catch { $ErrorMessage = $_; Write-Output $ErrorMessage; exit 1; } One problem I had to solve was: The SQL Data Compare installation folder contains the version number at the end: C:\\Program Files (x86)\\Red Gate\\SQL Data Compare 13. This makes it hard to find the SQLDataCompare.exe because I can’t guarantee which version is installed.\nThat’s what the function Get-InstallPath solves: it looks at the Windows Registry and tries to find the installation path for SQL Data Compare. Note that I used -like \"*$ProgramName*\" to solve the version problem on the installation folder. I gladly copied and slightly adapted the code from June Blender’s Blog post: How to find an installation directory\nThe rest is pretty straightforward. It calls the function and checks if SQL Data Compare is installed on the machine. Then it validates if the .xml file provided exists. Finally at line 83 it invokes SQLDataCompare.exe passing the path to the .xml file.\nAnd that’s it! You have an updated database again :)\nNote 1: This was the solution that was the fastest to build and that brought immediate value to us. It might not be the most perfect one though. In the end, we had to choose the approach that would bring the most value with minimal efforts. Also, I’m a PowerShell noob so please, if you find something that can be improved let me know in the comments!\nNote 2: This post is basically about Redgate SQL Data Compare but this is not a promoted post nor I’m benefiting from it. We already use their products in our office and this was just a way of sharing our use case.\nHope this was helpful.\n","wordCount":"1220","inLanguage":"en","datePublished":"2018-08-17T20:41:00Z","dateModified":"2018-08-17T20:41:00Z","author":{"@type":"Person","name":"Joao Grassi"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://blog.joaograssi.com/powershell-sql-data-compare-sync/"},"publisher":{"@type":"Organization","name":"Joao Grassi's blog","logo":{"@type":"ImageObject","url":"https://blog.joaograssi.com/favicon.ico"}}}</script>
</head>
<body id=top>
<script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add('dark'):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove('dark'):window.matchMedia('(prefers-color-scheme: dark)').matches&&document.body.classList.add('dark')</script>
<header class=header>
<nav class=nav>
<div class=logo>
<a href=https://blog.joaograssi.com accesskey=h title="Joao Grassi's blog (Alt + H)">Joao Grassi's blog</a>
<span class=logo-switches>
<button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
</button>
</span>
</div>
<ul id=menu>
<li>
<a href=https://blog.joaograssi.com/archives/ title=Archives>
<span>Archives</span>
</a>
</li>
<li>
<a href=https://blog.joaograssi.com/tags/ title=Tags>
<span>Tags</span>
</a>
</li>
<li>
<a href=https://blog.joaograssi.com/series/ title=Series>
<span>Series</span>
</a>
</li>
</ul>
</nav>
</header>
<main class=main>
<article class=post-single>
<header class=post-header>
<h1 class=post-title>
Syncing database data with PowerShell and SQL Data Compare
</h1>
<div class=post-description>
Learn how to use PowerShell to sync databases with the help of Redgate SQL Data Compare in a configurable and easy to maintain way.
</div>
</header>
<div class=post-content><p>The database team at my current job had successfully integrated the databases into source control using <a href=https://www.red-gate.com/products/sql-development/sql-source-control/>Redgate SQL Source Control</a>. Developers now have a local instance of the databases linked to Source Control and for them to add or change things it&rsquo;s a breeze.</p>
<p>The &ldquo;adding databases into source control&rdquo; statement is comprised of basically adding all the objects to source control. E.g. Tables, Views, Procedures and so on. Apart from adding database objects, there were also a couple of Tables identified as &ldquo;Enum&rdquo; tables. These tables are those that all of us developers are very familiar with. They usually contain lookup data, like Statuses and Countries.</p>
<figure class=figure-border>
<img class=img-center src=/powershell-sql-data-compare-sync/enumtable.png alt="An example of an Enum table" loading=lazy>
<figcaption class=img-caption>An example of an Enum table</figcaption>
</figure>
<p><strong>The problem started here</strong>: We have several data centers and these enum data should be, of course, the same everywhere. At this point, when someone wanted a new value available in production, they would add it, <code>commit</code> and <code>push</code>. Then, open a ticket with the database team so they could deploy the new value everywhere. As you are probably thinking, this is.. let&rsquo;s say, not very efficient.</p>
<p>To solve that we built a tool to manage this set of Enum/Configuration data. This tool is responsible for creating and sending this data everywhere. This was great since our tool now synchronizes the changes to all production db&rsquo;s and to one internal &ldquo;master&rdquo;. This improved drastically the productivity for everyone.</p>
<p>But, there was one downside: The developer&rsquo;s local instances were now outdated!. Since the enum tables are now managed by an external tool, there was no need to keep them in source control. And if they are not in source control developers can&rsquo;t just do <code>git pull</code> and expect to get the data anymore.</p>
<h2 id=the-solution>The solution<a hidden class=anchor aria-hidden=true href=#the-solution>#</a></h2>
<p>Use Redgate SQL Data Compare! Maybe not everyone knows but SQL Data Compare also works via the <a href=https://documentation.red-gate.com/sdc13/using-the-command-line>command line</a>. Basically everything you can do using the UI you can do using the command line, which is awesome!</p>
<h3 id=our-requirements>Our requirements:<a hidden class=anchor aria-hidden=true href=#our-requirements>#</a></h3>
<ol>
<li>Develop a solution that works seamlessly and that requires minimal effort from the developers</li>
<li>That would be easy to change once more Enum tables are removed from source control</li>
</ol>
<p>Having that in mind, what we came up was: A <strong>PowerShell</strong> script that uses SQL Data Compare to &ldquo;sync&rdquo; the dev&rsquo;s local instance with the master database managed by our central tool.</p>
<h3 id=challenges>Challenges:<a hidden class=anchor aria-hidden=true href=#challenges>#</a></h3>
<p>The PowerShell script more or less solved requirement <strong>#1</strong>. Developers would still have to run the script, but that can be easily solved by scheduling a task on Windows Task Scheduler. So requirement 1 - Solved!</p>
<p>Requirement <strong>#2</strong> was a little more tricky though. Summarizing, we had to compare 3 databases and each had different configurations (which Table to compare and so on). Also important was: As we take more Enum data out of source control, we needed a way to easily add the new tables in the comparison so developers could get fresh data again.</p>
<p>Fortunately, SQL Data Compare command line offers a way to use a <code>.xml</code> file to specify the parameters and configuration relevant to each database. There&rsquo;s a nice documentation with a few examples on how to <a href=https://documentation.red-gate.com/sdc13/using-the-command-line/examples-using-the-command-line/using-xml-to-specify-command-line-arguments>use XML to specify command line arguments</a></p>
<p>We took leverage of the <code>.xml</code> configuration files and created one for each database we needed to compare. This is nice because:</p>
<ol>
<li>You can (and should!) put it on source control. So changes are made in a safe way</li>
<li>It separates each database with its own set of configurations and tables</li>
<li>Allows the PowerShell script to be &ldquo;generic&rdquo; and database agnostic.</li>
</ol>
<h2 id=code>Code:<a hidden class=anchor aria-hidden=true href=#code>#</a></h2>
<p>Basically the PowerShell script accepts just one argument. The name of the <code>.xml</code> configuration file. An example of such configuration file looks like this:</p>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-xml data-lang=xml><span style=color:#75715e>&lt;?xml version=&#34;1.0&#34;?&gt;</span> 
<span style=color:#f92672>&lt;commandline&gt;</span>
    <span style=color:#f92672>&lt;database1&gt;</span>myapp-db<span style=color:#f92672>&lt;/database1&gt;</span>
    <span style=color:#f92672>&lt;server1&gt;</span>DB-MASTER<span style=color:#f92672>&lt;/server1&gt;</span>
    <span style=color:#f92672>&lt;database2&gt;</span>myapp-db<span style=color:#f92672>&lt;/database2&gt;</span>
    <span style=color:#f92672>&lt;server2&gt;</span>(local)\DevInstance<span style=color:#f92672>&lt;/server2&gt;</span>
    <span style=color:#f92672>&lt;verbose/&gt;</span>
    <span style=color:#f92672>&lt;include&gt;</span>Table<span style=color:#f92672>&lt;/include&gt;</span>
    <span style=color:#f92672>&lt;include&gt;</span>Identical<span style=color:#f92672>&lt;/include&gt;</span>
    <span style=color:#f92672>&lt;include&gt;</span>Table:\[AppStatus\]<span style=color:#f92672>&lt;/include&gt;</span>
    <span style=color:#f92672>&lt;sync/&gt;</span>
<span style=color:#f92672>&lt;/commandline&gt;</span>
</code></pre></div><p>I&rsquo;m not going into too much details of what each node do since the documentation already offers everything you need to know: <a href=https://documentation.red-gate.com/sdc13/using-the-command-line/command-line-syntax/switches-used-in-the-command-line>Switches used in the command line</a> and <a href=https://documentation.red-gate.com/sdc13/using-the-command-line/command-line-syntax/options-used-in-the-command-line>Options used in the command line</a></p>
<h3 id=the-final-script-looks-like-this>The final script looks like this:<a hidden class=anchor aria-hidden=true href=#the-final-script-looks-like-this>#</a></h3>
<div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell>param <span style=color:#f92672>(</span>   
    <span style=color:#f92672>[</span>Parameter<span style=color:#f92672>(</span>Mandatory <span style=color:#f92672>=</span> $true<span style=color:#f92672>)]</span>
    <span style=color:#f92672>[</span>string<span style=color:#f92672>]</span>
    $compareConfigFile
<span style=color:#f92672>)</span>

&lt;<span style=color:#75715e># Get the Installation path of a given program</span>
Gladly copied from: 
https://info.sapien.com/index.php/scripting/scripting-how-tos/how-to-find-installation-directory 
<span style=color:#75715e>#&gt; </span>
<span style=color:#66d9ef>function</span> Get-InstallPath
<span style=color:#f92672>{</span>
    <span style=color:#f92672>[</span>CmdletBinding<span style=color:#f92672>()]</span>
    <span style=color:#f92672>[</span>OutputType<span style=color:#f92672>([</span>PSCustomObject<span style=color:#f92672>])]</span>
    Param
    <span style=color:#f92672>(</span>
        <span style=color:#f92672>[</span>Parameter<span style=color:#f92672>(</span>Mandatory <span style=color:#f92672>=</span> $true<span style=color:#f92672>)]</span>
        <span style=color:#f92672>[</span>SupportsWildcards<span style=color:#f92672>()]</span>
        <span style=color:#f92672>[</span>string<span style=color:#f92672>]</span>
        $ProgramName
    <span style=color:#f92672>)</span>
    
    $result <span style=color:#f92672>=</span> @<span style=color:#f92672>()</span>
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>$inst <span style=color:#f92672>=</span> Get-ChildItem <span style=color:#e6db74>&#34;HKLM:\SOFTWARE\Microsoft\Windows\CurrentVersion\Installer\UserData\*\Products\*\InstallProperties&#34;</span> -ErrorAction SilentlyContinue<span style=color:#f92672>)</span> 
    <span style=color:#f92672>{</span>
        $inst | Where-Object <span style=color:#f92672>{</span>
            <span style=color:#f92672>(</span>$DisplayName <span style=color:#f92672>=</span> $_.getValue<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;DisplayName&#39;</span><span style=color:#f92672>))</span> -like <span style=color:#e6db74>&#34;*</span>$ProgramName<span style=color:#e6db74>*&#34;</span>
        <span style=color:#f92672>}</span> |
        ForEach-Object     <span style=color:#f92672>{</span>
            $result +<span style=color:#f92672>=</span> <span style=color:#f92672>[</span>PSCustomObject<span style=color:#f92672>]</span>@<span style=color:#f92672>{</span>
                <span style=color:#e6db74>&#39;DisplayName&#39;</span> <span style=color:#f92672>=</span> $displayName
                <span style=color:#e6db74>&#39;Publisher&#39;</span> <span style=color:#f92672>=</span> $_.getValue<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;Publisher&#39;</span><span style=color:#f92672>)</span>
                <span style=color:#e6db74>&#39;InstallPath&#39;</span> <span style=color:#f92672>=</span> $_.getValue<span style=color:#f92672>(</span><span style=color:#e6db74>&#39;InstallLocation&#39;</span><span style=color:#f92672>)</span>
            <span style=color:#f92672>}</span>
        <span style=color:#f92672>}</span>
    <span style=color:#f92672>}</span>
    <span style=color:#66d9ef>else</span>
    <span style=color:#f92672>{</span>
        Write-Error <span style=color:#e6db74>&#34;Cannot get the InstallProperties registry keys.&#34;</span>;
    <span style=color:#f92672>}</span>
    
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>$result<span style=color:#f92672>)</span>
    <span style=color:#f92672>{</span>
        <span style=color:#66d9ef>return</span> $result;
    <span style=color:#f92672>}</span>
    <span style=color:#66d9ef>else</span>
    <span style=color:#f92672>{</span>
        Write-Error <span style=color:#e6db74>&#34;Cannot get the InstallProperties registry key for </span>$ProgramName<span style=color:#e6db74>&#34;</span>;
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

try <span style=color:#f92672>{</span>

    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!<span style=color:#f92672>(</span>Test-Path $compareConfigFile<span style=color:#f92672>))</span> 
    <span style=color:#f92672>{</span>
        Throw <span style=color:#e6db74>&#34;Could not find the specified xml config file: </span>$compareConfigFile<span style=color:#e6db74>&#34;</span>;
    <span style=color:#f92672>}</span>

    Write-Host <span style=color:#e6db74>&#34;################ Initilizing SQL Data Compare Script #################&#34;</span>;
    Write-Host <span style=color:#e6db74>&#34;&#34;</span>;

    Write-Host <span style=color:#e6db74>&#34;Info: &#34;</span> -ForegroundColor Blue -NoNewline; Write-Host <span style=color:#e6db74>&#34;Looking for SQL Data Compare on the machine...&#34;</span>;
    $sqlDataCompareFolderName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SQL Data Compare&#34;</span>;
    $sqlDataCompareExecutableName <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;SQLDataCompare.exe&#34;</span>;
    
    <span style=color:#75715e># Gets the installation path from registry for SQL Data Compare (the version number at the end makes impossible to hardcode)</span>
    $sqlCompareInstallPath <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>Get-InstallPath -ProgramName $sqlDataCompareFolderName<span style=color:#f92672>)</span>.InstallPath;
    $fullExecutablePath <span style=color:#f92672>=</span> Join-Path -path $sqlCompareInstallPath -childpath $sqlDataCompareExecutableName;

    <span style=color:#75715e># Should be there, but just as a sanity check</span>
    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>!<span style=color:#f92672>(</span>Test-Path  <span style=color:#e6db74>&#34;</span>$fullExecutablePath<span style=color:#e6db74>&#34;</span><span style=color:#f92672>))</span> 
    <span style=color:#f92672>{</span>
        Throw <span style=color:#e6db74>&#34;SQL Data Compare was not found in the machine.&#34;</span>;
    <span style=color:#f92672>}</span>

    Write-Host <span style=color:#e6db74>&#34;Success: &#34;</span> -ForegroundColor Green -NoNewline; Write-Host <span style=color:#e6db74>&#34;SQL Data Compare found at: </span>$fullExecutablePath<span style=color:#e6db74>&#34;</span>;
    Write-Host <span style=color:#e6db74>&#34;&#34;</span>;

    Write-Host <span style=color:#e6db74>&#34;Info: &#34;</span> -ForegroundColor Blue -NoNewline; Write-Host <span style=color:#e6db74>&#34;Starting SQL Data Compare using the following XML config file: </span>$compareConfigFile<span style=color:#e6db74>&#34;</span>;    
    Write-Host <span style=color:#e6db74>&#34;&#34;</span>;

    &amp; <span style=color:#e6db74>&#34;</span>$fullExecutablePath<span style=color:#e6db74>&#34;</span> /Argfile:$compareConfigFile;

    <span style=color:#66d9ef>if</span> <span style=color:#f92672>(</span>$LASTEXITCODE -eq 0<span style=color:#f92672>)</span>
    <span style=color:#f92672>{</span>
        Write-Host <span style=color:#e6db74>&#34;Database updated successfully.&#34;</span> -ForegroundColor Green;
    <span style=color:#f92672>}</span>
    <span style=color:#66d9ef>else</span> 
    <span style=color:#f92672>{</span>
        Write-Host <span style=color:#e6db74>&#34;Error: Database updated failed. See the above errors. &#34;</span> -ForegroundColor Red;        
    <span style=color:#f92672>}</span>
<span style=color:#f92672>}</span>

Catch <span style=color:#f92672>{</span>
    $ErrorMessage <span style=color:#f92672>=</span> $_;
    Write-Output $ErrorMessage;
    exit 1;
<span style=color:#f92672>}</span>
</code></pre></div><p>One problem I had to solve was: The SQL Data Compare installation folder contains the version number at the end: <code>C:\Program Files (x86)\Red Gate\SQL Data Compare 13</code>. This makes it hard to find the <code>SQLDataCompare.exe</code> because I can&rsquo;t guarantee which version is installed.</p>
<p>That&rsquo;s what the function <code>Get-InstallPath</code> solves: it looks at the Windows Registry and tries to find the installation path for <code>SQL Data Compare</code>. Note that I used <code>-like "*$ProgramName*"</code> to solve the version problem on the installation folder. I gladly copied and slightly adapted the code from <a href=https://twitter.com/juneb_get_help>June Blender&rsquo;s</a> Blog post: <a href=https://info.sapien.com/index.php/scripting/scripting-how-tos/how-to-find-installation-directory>How to find an installation directory</a></p>
<p>The rest is pretty straightforward. It calls the function and checks if SQL Data Compare is installed on the machine. Then it validates if the <code>.xml</code> file provided exists. Finally at line <code>83</code> it invokes <code>SQLDataCompare.exe</code> passing the path to the <code>.xml</code> file.</p>
<p>And that&rsquo;s it! You have an updated database again :)</p>
<p><strong>Note 1</strong>: This was the solution that was the fastest to build and that brought immediate value to us. It might not be the most perfect one though. In the end, we had to choose the approach that <a href=https://www.codeproject.com/Articles/824234/Pareto-Programming>would bring the most value with minimal efforts</a>. Also, I&rsquo;m a PowerShell noob so please, if you find something that can be improved let me know in the comments!</p>
<p><strong>Note 2</strong>: This post is basically about Redgate SQL Data Compare but this is not a promoted post nor I&rsquo;m benefiting from it. We already use their products in our office and this was just a way of sharing our use case.</p>
<p>Hope this was helpful.</p>
</div>
<footer class=post-footer>
<ul class=post-tags>
<li><a href=https://blog.joaograssi.com/tags/powershell/>powershell</a></li>
<li><a href=https://blog.joaograssi.com/tags/sql/>SQL</a></li>
<li><a href=https://blog.joaograssi.com/tags/redgate-sql-data-compare/>redgate-sql-data-compare</a></li>
</ul>
</footer>
</article>
</main>
<footer class=footer>
<span>&copy; 2022 <a href=https://blog.joaograssi.com>Joao Grassi's blog</a></span>
<span>
Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://git.io/hugopapermod rel=noopener target=_blank>PaperMod</a>
</span>
</footer>
<a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script data-goatcounter=https://trinity.goatcounter.com/count src=/count.js type=text/javascript></script>
<script>let menu=document.getElementById('menu');menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(a=>{a.addEventListener("click",function(b){b.preventDefault();var a=this.getAttribute("href").substr(1);window.matchMedia('(prefers-reduced-motion: reduce)').matches?document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(a)}']`).scrollIntoView({behavior:"smooth"}),a==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${a}`)})})</script>
<script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script>
<script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove('dark'),localStorage.setItem("pref-theme",'light')):(document.body.classList.add('dark'),localStorage.setItem("pref-theme",'dark'))})</script>
</body>
</html>